#!/bin/sh

BOLD="\033[1m"
GREEN="\033[32m"
RED="\033[31m"
YELLOW="\033[33m"
BLUE="\033[34m"
GRAY="\033[90m"
RESET="\033[0m"

divider(){ echo "${GRAY}â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€${RESET}"; }
stage(){ echo ""; divider; echo "${BOLD}${BLUE}ğŸš€ Step $1${RESET} ${BOLD}${2}${RESET}"; divider; echo ""; }

# Step 1: Type Checking
stage "1/3" "Type Checking"
echo "ğŸ“ Running typecheck..."
pnpm run typecheck || {
  echo ""; echo "${RED}âŒ Type errors found!${RESET}";
  echo "${YELLOW}ğŸ’¡ Tip:${RESET} Run 'pnpm run typecheck' to debug locally."; exit 1; }
echo "${GREEN}âœ… Typecheck passed!${RESET}"

# Step 2: Run Tests
stage "2/3" "Run Tests"
echo "ğŸ§ª Running tests..."
pnpm run test || {
  echo ""; echo "${RED}âŒ Test failures!${RESET}";
  echo "${YELLOW}ğŸ’¡ Tip:${RESET} Run 'pnpm run test' to debug locally."; exit 1; }
echo "${GREEN}âœ… All tests passed!${RESET}"

# Step 3: Build Validation
stage "3/3" "Build Validation"
echo "ğŸ—ï¸  Validating build..."
pnpm run build || {
  echo ""; echo "${RED}âŒ Build failed!${RESET}";
  echo "${YELLOW}ğŸ’¡ Tip:${RESET} Run 'pnpm run build' to debug locally."; exit 1; }
echo "${GREEN}âœ… Build successful!${RESET}"

stage "âœ… Done" "Pre-push Checks Passed"
echo "${GREEN}ğŸ‰ All checks passed!${RESET}"
echo "${GRAY}(Ready to push with confidence ğŸš€)${RESET}"